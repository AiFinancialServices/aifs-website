name: Bootstrap Website V2 (hands-off upgrade)

on:
  workflow_dispatch: {}

permissions:
  contents: write
  pull-requests: write

jobs:
  upgrade:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with: { fetch-depth: 0 }

      - name: Prepare bot branch
        run: |
          git config user.name  "aifs-bot"
          git config user.email "bot@aifinancialservicesinc.com"
          git checkout -B bot/updates

      - name: Write files (V2 site)
        shell: bash
        run: |
          mkdir -p assets js trust waitlist .github/workflows

          # index.html
          cat > index.html <<'EOF'
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ai Financial Services</title>
  <meta name="description" content="Smart Finance. Powered by AI. Built for Everyone.">
  <link rel="icon" href="assets/logo.png">
  <link href="styles.css" rel="stylesheet">
  <script>window.WAITLIST_ENDPOINT='YOUR_APPS_SCRIPT_WEB_APP_URL';</script>
  <script defer src="js/waitlist.js"></script>
</head>
<body>
  <header class="container">
    <div class="brand">
      <img src="assets/logo.png" alt="Ai Financial Services Logo" class="logo">
      <span class="brandname">Ai Financial Services</span>
    </div>
    <nav>
      <a href="#services">Services</a>
      <a href="trust/trust.html">Trust</a>
      <a href="#contact">Contact</a>
      <a class="cta" href="#join">Join Waitlist</a>
    </nav>
  </header>

  <section class="hero">
    <div class="container hero-inner">
      <div class="hero-copy">
        <h1>Smart Finance. Powered by AI. Built for Everyone.</h1>
        <p>Personal + Small Business finance in one global platform: AI bookkeeping, tax, and a virtual CFO — with transparency and compliance built-in.</p>
        <a class="button" href="#join">Get Started</a>
      </div>
      <div class="hero-art">
        <img src="assets/logo.png" alt="AI Finance" class="hero-art-img"/>
      </div>
    </div>
  </section>

  <section id="services" class="section container">
    <h2>What We Offer</h2>
    <div class="grid">
      <div class="card"><h3>Individuals</h3><ul>
        <li>AI tax prep & filing</li><li>Smart budgeting & alerts</li><li>Credit optimization</li>
      </ul></div>
      <div class="card"><h3>Small Businesses</h3><ul>
        <li>Automated bookkeeping & dashboards</li><li>Virtual CFO Lite & forecasting</li><li>Sales & payroll tax compliance</li>
      </ul></div>
      <div class="card"><h3>Trust & Compliance</h3><ul>
        <li>GDPR/CCPA-ready privacy controls</li><li>Immutable audit logs</li><li>Regulatory sandboxes (UK, SG, US)</li>
      </ul></div>
    </div>
  </section>

  <section id="join" class="section container">
    <h2>Join the Waitlist</h2>
    <form id="waitlist-form" class="waitlist">
      <input type="text" name="name" placeholder="Your name" required>
      <input type="email" name="email" placeholder="Your email" required>
      <select name="segment">
        <option>I'm an individual</option>
        <option>I'm a small business</option>
        <option>Investor / Partner</option>
      </select>
      <button type="submit" class="button">Request Access</button>
    </form>
    <p id="waitlist-status" class="fineprint"></p>
    <p class="fineprint">By submitting, you agree to our <a href="privacy.html">Privacy Policy</a> and <a href="terms.html">Terms of Service</a>.</p>
  </section>

  <section id="contact" class="section alt">
    <div class="container">
      <h2>Contact</h2>
      <div class="grid two">
        <div>
          <h4>General</h4>
          <p><a href="mailto:info@aifinancialservicesinc.com">info@aifinancialservicesinc.com</a></p>
          <h4>Investors</h4>
          <p><a href="mailto:investors@aifinancialservicesinc.com">investors@aifinancialservicesinc.com</a></p>
        </div>
        <div>
          <h4>US Year 1 Cities</h4>
          <p>NYC · Boston · Philadelphia · Miami · Atlanta · Chicago · Detroit · Minneapolis · Dallas · Houston · Austin · Nashville · Los Angeles · San Francisco · Seattle · Denver</p>
        </div>
      </div>
    </div>
  </section>

  <footer class="footer">
    <div class="container">
      <p>© 2025 Ai Financial Services, Inc. EIN 39-4283355 · A Delaware corporation registered in Texas.</p>
      <p><a href="privacy.html">Privacy</a> · <a href="terms.html">Terms</a></p>
    </div>
  </footer>
</body>
</html>
EOF

          # styles.css
          cat > styles.css <<'EOF'
:root{ --blue:#0f2454; --green:#12a873; --ink:#0c1222; --muted:#64748b; --bg:#f8fafc; }
*{box-sizing:border-box} body{margin:0; font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial; color:var(--ink); background:var(--bg);}
.container{max-width:1080px; margin:0 auto; padding:0 20px;}
header{display:flex; align-items:center; justify-content:space-between; padding:16px 0; background:#fff; position:sticky; top:0; border-bottom:1px solid #e5e7eb;}
.brand{display:flex; align-items:center; gap:10px;}
.brandname{font-weight:800; color:var(--ink);}
.logo{height:44px; width:auto;}
nav a{margin:0 10px; text-decoration:none; color:var(--ink); font-weight:600;}
nav a.cta{padding:8px 12px; background:var(--blue); color:#fff; border-radius:10px;}
.hero{background:linear-gradient(135deg, #0f2454 0%, #12a873 100%); color:#fff; padding:64px 0;}
.hero-inner{display:grid; grid-template-columns:1.2fr 1fr; gap:24px; align-items:center;}
.hero h1{font-size:40px; margin:0 0 10px;}
.hero p{opacity:.95; font-size:18px; margin:0 0 20px;}
.button{display:inline-block; padding:12px 16px; background:#fff; color:var(--blue); border-radius:12px; font-weight:700; text-decoration:none;}
.hero-art-img{width:180px; height:auto; filter:drop-shadow(0 12px 24px rgba(0,0,0,.2)); background:#fff; border-radius:20px; padding:20px;}
.section{padding:56px 0;}
.section.alt{background:#fff;}
.grid{display:grid; gap:20px; grid-template-columns:repeat(3,1fr);}
.grid.two{grid-template-columns:repeat(2,1fr);}
.card{background:#fff; border:1px solid #e5e7eb; border-radius:16px; padding:20px; box-shadow:0 6px 14px rgba(10,18,40,.06);}
.card h3{margin-top:0; color:var(--blue);}
.metric{background:#fff; border:1px solid #e5e7eb; border-radius:16px; padding:24px; text-align:center; font-weight:600;}
.metric .big{font-size:28px; color:var(--green);}
.waitlist{display:grid; gap:12px; grid-template-columns:1fr 1fr 1fr auto;}
.waitlist input, .waitlist select{padding:12px; border:1px solid #cbd5e1; border-radius:10px; font-size:14px;}
.waitlist .button{padding:12px 18px;}
.fineprint{font-size:12px; color:var(--muted); margin-top:10px;}
.footer{padding:24px 0; text-align:center; color:var(--muted);}
.success{color:#0f5132; background:#d1e7dd; border:1px solid #badbcc; padding:10px; border-radius:8px;}
.error{color:#842029; background:#f8d7da; border:1px solid #f5c2c7; padding:10px; border-radius:8px;}
@media (max-width:900px){ .hero-inner{grid-template-columns:1fr} .grid{grid-template-columns:1fr} .grid.two{grid-template-columns:1fr} .waitlist{grid-template-columns:1fr} }
EOF

          # waitlist JS
          cat > js/waitlist.js <<'EOF'
(function(){
  const form = document.getElementById('waitlist-form');
  const statusEl = document.getElementById('waitlist-status');
  const endpoint = window.WAITLIST_ENDPOINT || 'YOUR_APPS_SCRIPT_WEB_APP_URL';
  function setStatus(msg, ok=true){
    statusEl.className = ok ? 'fineprint success' : 'fineprint error';
    statusEl.textContent = msg;
  }
  if(!form) return;
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    setStatus('Submitting…');
    try {
      const data = Object.fromEntries(new FormData(form).entries());
      const res = await fetch(endpoint, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ ...data, ts: new Date().toISOString() })
      });
      if(!res.ok) throw new Error('Network response was not ok');
      setStatus("Thanks! You are on the list. We'll be in touch shortly.", true);
      form.reset();
    } catch(err){
      console.error(err);
      setStatus('Sorry, something went wrong. Please try again later.', false);
    }
  });
})();
EOF

          # privacy.html
          cat > privacy.html <<'EOF'
<!doctype html><html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Privacy Policy — Ai Financial Services</title>
<link rel="icon" href="assets/logo.png"><link href="styles.css" rel="stylesheet"></head>
<body><header class="container">
  <div class="brand"><img src="assets/logo.png" class="logo"><span class="brandname">Ai Financial Services</span></div>
  <nav><a href="index.html#services">Services</a><a href="trust/trust.html">Trust</a><a href="index.html#contact">Contact</a></nav>
</header>
<section class="section container">
  <h1>Privacy Policy</h1>
  <p>We collect the minimum data necessary to provide our services, including name, email, and usage data.</p>
  <ul><li>Data Residency: EU and US.</li><li>Security: TLS 1.3 in transit, AES-256 at rest.</li><li>Access: You may request a copy or deletion of your data at any time.</li></ul>
  <p>Contact: <a href="mailto:privacy@aifinancialservicesinc.com">privacy@aifinancialservicesinc.com</a></p>
</section>
<footer class="footer"><div class="container"><p>© 2025 Ai Financial Services, Inc.</p></div></footer></body></html>
EOF

          # terms.html
          cat > terms.html <<'EOF'
<!doctype html><html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Terms of Service — Ai Financial Services</title>
<link rel="icon" href="assets/logo.png"><link href="styles.css" rel="stylesheet"></head>
<body><header class="container">
  <div class="brand"><img src="assets/logo.png" class="logo"><span class="brandname">Ai Financial Services</span></div>
  <nav><a href="index.html#services">Services</a><a href="trust/trust.html">Trust</a><a href="index.html#contact">Contact</a></nav>
</header>
<section class="section container">
  <h1>Terms of Service</h1>
  <p>By using this site, you agree to our terms. Services are subject to licensing and regional availability.</p>
  <ul><li>Acceptable Use: No unlawful activities.</li><li>Disclaimer: Informational materials are not financial or tax advice.</li><li>Limitation of Liability: To the fullest extent permitted by law.</li></ul>
  <p>Contact: <a href="mailto:legal@aifinancialservicesinc.com">legal@aifinancialservicesinc.com</a></p>
</section>
<footer class="footer"><div class="container"><p>© 2025 Ai Financial Services, Inc.</p></div></footer></body></html>
EOF

          # trust page
          cat > trust/trust.html <<'EOF'
<!doctype html>
<html lang="en"><head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Transparency & Trust — Ai Financial Services</title>
  <link rel="icon" href="../assets/logo.png"><link href="../styles.css" rel="stylesheet">
  <script>
    async function loadStatus(){
      const card = document.getElementById('status-card');
      try {
        const res = await fetch('status.json', { cache: 'no-cache' });
        const data = await res.json();
        card.innerHTML = `
          <div class="metric"><span class="big">${data.targetUptime}</span><br>Target Uptime</div>
          <div class="metric"><span class="big">${data.incidentSLA}</span><br>Incident Disclosure SLA</div>
          <div class="metric"><span class="big">${data.dataResidency}</span><br>Data Residency</div>
        `;
        document.getElementById('licenses').innerHTML = data.licenses.map(l => `<li>${l}</li>`).join('');
        document.getElementById('audits').innerText = data.auditNote;
      } catch(e){ card.innerHTML = '<p class="fineprint error">Status unavailable. Check back soon.</p>'; }
    }
    document.addEventListener('DOMContentLoaded', loadStatus);
  </script>
</head>
<body>
<header class="container">
  <div class="brand"><img src="../assets/logo.png" class="logo" alt="Logo"><span class="brandname">Ai Financial Services</span></div>
  <nav><a href="../index.html#services">Services</a><a href="trust.html" class="cta">Trust</a><a href="../index.html#contact">Contact</a></nav>
</header>
<section class="section container">
  <h1>Transparency & Trust</h1>
  <p>We operate with real-time transparency on uptime, audits, and licensing.</p>
  <div id="status-card" class="grid" style="margin-top:20px;"></div>
</section>
<section class="section container"><h2>Licensing & Registration</h2><ul id="licenses"></ul></section>
<section class="section container"><h2>Security & Privacy</h2>
  <p>Data encrypted in transit (TLS 1.3) and at rest (AES-256). Regional data residency in the EU and US. Continuous monitoring enabled.</p>
  <p id="audits" class="fineprint"></p>
</section>
<footer class="footer"><div class="container"><p>© 2025 Ai Financial Services, Inc.</p>
  <p><a href="../privacy.html">Privacy</a> · <a href="../terms.html">Terms</a></p></div></footer>
</body></html>
EOF

          # trust/status.json
          cat > trust/status.json <<'EOF'
{
  "targetUptime": "99.9%",
  "incidentSLA": "72 hrs",
  "dataResidency": "EU / US",
  "licenses": [
    "Delaware C-Corp (filed)",
    "Texas Foreign Registration (pending filing)",
    "IRS E-File Provider (planned)",
    "SEC/FINRA registrations (planned, Year 2)",
    "FCA/MAS sandbox participation (planned)"
  ],
  "auditNote": "ISO/SOC2 readiness in progress; third-party audits to be posted here post-launch."
}
EOF

          # vercel.json (security headers)
          cat > vercel.json <<'EOF'
{
  "cleanUrls": true,
  "headers": [
    {
      "source": "/(.*)",
      "headers": [
        {"key":"X-Content-Type-Options","value":"nosniff"},
        {"key":"Referrer-Policy","value":"strict-origin-when-cross-origin"},
        {"key":"Permissions-Policy","value":"geolocation=()"},
        {"key":"X-Frame-Options","value":"DENY"}
      ]
    }
  ]
}
EOF

          # Waitlist docs
          cat > waitlist/README.md <<'EOF'
# Waitlist Backend (Google Sheets + Apps Script)
1) Create a Google Sheet "AIFS Waitlist" with columns: Timestamp, Name, Email, Segment, ts
2) Extensions → Apps Script → paste apps_script_template.gs
3) Deploy → Web app → Execute as: Me, Access: Anyone (or Anyone with link)
4) Copy the Web App URL and set it in index.html: window.WAITLIST_ENDPOINT='...'
EOF

          cat > waitlist/apps_script_template.gs <<'EOF'
const SHEET_NAME = 'AIFS Waitlist';
function doPost(e) {
  try {
    const body = JSON.parse(e.postData.contents);
    const ss = SpreadsheetApp.getActiveSpreadsheet();
    const sheet = ss.getSheetByName(SHEET_NAME) || ss.insertSheet(SHEET_NAME);
    sheet.appendRow([new Date(), body.name || '', body.email || '', body.segment || '', body.ts || '']);
    return ContentService.createTextOutput(JSON.stringify({ ok: true })).setMimeType(ContentService.MimeType.JSON);
  } catch (err) {
    return ContentService.createTextOutput(JSON.stringify({ ok:false, error: String(err) })).setMimeType(ContentService.MimeType.JSON);
  }
}
EOF

      - name: Commit changes
        run: |
          git add -A
          if git diff --cached --quiet; then
            echo "No changes to commit."
          else
            git commit -m "Bootstrap Website V2 (waitlist + trust + legal + headers)"
          fi

      - name: Push bot branch
        run: git push origin bot/updates --force

      - name: Merge to main
        run: |
          if ! git show-ref --verify --quiet refs/heads/main; then git branch -M main; fi
          git checkout main
          git pull origin main || true
          git merge --no-edit --strategy-option theirs bot/updates || true
          git push origin main
